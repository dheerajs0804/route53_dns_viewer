<div class="dns-viewer-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <div class="header-icon">
        <span class="icon-text">üîç</span>
      </div>
      <span class="header-title">Route 53 DNS Viewer</span>
    </div>
    <div class="header-right">
      <button mat-icon-button (click)="logout()" class="logout-btn">
        <mat-icon>logout</mat-icon>
      </button>
    </div>
  </div>

  <div class="content">
    <!-- Search Form -->
    <div class="search-section">
      <h2 class="section-title">Search DNS Records</h2>
      <p class="section-subtitle">Select a hosted zone and enter a prefix to filter records</p>

      <form [formGroup]="searchForm" class="search-form">
        <div class="form-row">
          <!-- All Zones Option -->
          <div class="form-group">
            <mat-checkbox formControlName="allZones" class="all-zones-checkbox">
              Search across all hosted zones
            </mat-checkbox>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Hosted Zone</label>
            <mat-form-field appearance="fill" class="hosted-zone-select" [class.disabled]="searchForm.get('allZones')?.value">
              <mat-select formControlName="hostedZoneId" (selectionChange)="onZoneSelectionChange()" [disabled]="searchForm.get('allZones')?.value">
                <mat-option *ngFor="let zone of hostedZones" [value]="zone.id">
                  {{ zone.name }} ({{ zone.id }})
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="form-group">
            <label class="form-label">Search Prefix</label>
            <mat-form-field appearance="fill" class="search-input">
              <input matInput 
                     formControlName="prefix" 
                     placeholder="e.g., www, api, subdomain">
              <button mat-icon-button 
                      matSuffix 
                      (click)="clearSearch()" 
                      *ngIf="searchForm.get('prefix')?.value"
                      class="clear-btn">
                <span class="icon-text">√ó</span>
              </button>
            </mat-form-field>
            <span class="form-hint">Leave empty to show all records</span>
          </div>

          <div class="form-group">
            <button mat-raised-button 
                    color="warn" 
                    (click)="searchRecords()"
                    [disabled]="!canSearch() || isLoading"
                    class="search-btn mat-raised-button mat-primary">
              <span class="icon-text">üîÑ</span>
              <span>Search Records</span>
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Results Section -->
    <div class="results-section" *ngIf="dnsRecords.length > 0 || (canSearch() && !isLoading)">
      <div class="results-header">
        <div class="results-title">
          <h2>DNS Records ({{ dnsRecords.length }} found)</h2>
          <p class="results-subtitle" *ngIf="!searchForm.get('allZones')?.value">
            Showing records for {{ getZoneName(searchForm.get('hostedZoneId')?.value) }}
          </p>
          <p class="results-subtitle" *ngIf="searchForm.get('allZones')?.value">
            Showing records across all hosted zones
          </p>
        </div>
        <button mat-raised-button 
                (click)="exportToCsv()" 
                [disabled]="dnsRecords.length === 0"
                class="download-btn mat-raised-button mat-success">
          <span class="icon-text">‚¨áÔ∏è</span>
          Download CSV
        </button>
      </div>

      <div class="table-container" *ngIf="dnsRecords.length > 0">
        <table class="dns-table">
          <thead>
            <tr>
              <th class="record-name-header">RECORD NAME</th>
              <th class="type-header">TYPE</th>
              <th class="ttl-header">TTL</th>
              <th class="values-header">VALUES</th>
              <th class="zone-header" *ngIf="searchForm.get('allZones')?.value">HOSTED ZONE</th>
              <th class="actions-header">ACTIONS</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let record of dnsRecords" class="table-row">
              <td class="record-name-cell">
                <div class="record-name">{{ record.name }}</div>
              </td>
              <td class="type-cell">
                <span class="type-badge" [class]="'type-' + record.type.toLowerCase()">
                  {{ record.type }}
                </span>
              </td>
              <td class="ttl-cell">
                {{ record.ttl || '-' }}
              </td>
              <td class="values-cell">
                <div class="values-container">
                  <div *ngFor="let value of record.values" class="value-item">
                    {{ value }}
                  </div>
                  <div *ngIf="record.aliasTarget" class="alias-target">
                    Alias: {{ record.aliasTarget }}
                  </div>
                  <div *ngIf="record.values.length === 0 && !record.aliasTarget" class="no-values">
                    No values
                  </div>
                </div>
              </td>
              <td class="zone-cell" *ngIf="searchForm.get('allZones')?.value">
                <span class="zone-badge">{{ record.hostedZoneName || 'Unknown Zone' }}</span>
              </td>
              <td class="actions-cell">
                <div class="actions-container">
                  <!-- Delete button for individual records -->
                  <button mat-icon-button 
                          *ngIf="canDeleteRecord(record)"
                          (click)="deleteRecord(record)"
                          [disabled]="isRecordDeleting(record)"
                          class="delete-btn"
                          matTooltip="Delete Record">
                    <mat-spinner diameter="16" *ngIf="isRecordDeleting(record)"></mat-spinner>
                    <span class="icon-text" *ngIf="!isRecordDeleting(record)">üóëÔ∏è</span>
                  </button>
                  
                  <!-- More actions menu -->
                  <button mat-icon-button [matMenuTriggerFor]="menu" class="actions-btn">
                    <span class="icon-text">‚ãØ</span>
                  </button>
                  <mat-menu #menu="matMenu">
                    <button mat-menu-item (click)="copyToClipboard(record.name)">
                      <span class="icon-text menu-icon">üìã</span>
                      Copy Name
                    </button>
                    <button mat-menu-item (click)="copyToClipboard(record.values.join(', '))">
                      <span class="icon-text menu-icon">üìã</span>
                      Copy Values
                    </button>
                    <mat-divider *ngIf="canDeleteRecord(record)"></mat-divider>
                    <button mat-menu-item 
                            *ngIf="canDeleteRecord(record)"
                            (click)="deleteRecord(record)"
                            [disabled]="isRecordDeleting(record)"
                            class="delete-menu-item">
                      <span class="icon-text menu-icon">üóëÔ∏è</span>
                      Delete Record
                    </button>
                  </mat-menu>
                  
                  <!-- Warning for critical records -->
                  <div *ngIf="!canDeleteRecord(record)" 
                       class="critical-record-warning"
                       matTooltip="Critical system records cannot be deleted">
                    <span class="icon-text">üîí</span>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- No Results -->
      <div class="no-results" *ngIf="!isLoading && dnsRecords.length === 0 && searchForm.get('hostedZoneId')?.value">
        <div class="no-results-icon">üîç</div>
        <h3>No DNS records found</h3>
        <p *ngIf="searchForm.get('prefix')?.value">
          No records found matching prefix "{{ searchForm.get('prefix')?.value }}"
        </p>
        <p *ngIf="!searchForm.get('prefix')?.value">
          No records found in the selected hosted zone
        </p>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-section" *ngIf="isLoading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading DNS records...</p>
    </div>
  </div>
</div>